/*
 * Pronto Plugin
 * @author Ben Plum
 * @version 0.5.4-1
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function k(a){d.extend(c,a||{});c.$body=d("body");c.$container=d(c.container);f&&(history.replaceState({url:window.location.href,data:{title:d("head").find("title").text(),content:d(c.container).html()}},"state-"+window.location.href,window.location.href),h=window.location.href,g.on("popstate",l),c.$body.on("click.pronto",c.selector,m))}function m(a){var b=a.currentTarget;if(!(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)&&!(window.location.protocol!==b.protocol||window.location.host!== b.host)&&!(b.hash&&b.href.replace(b.hash,"")===window.location.href.replace(location.hash,"")||b.href===window.location.href+"#")){a.preventDefault();a.stopPropagation();var c=b.href;g.trigger("pronto.request");d.ajax({url:c+(-1<c.indexOf("?")?"&pronto=true":"?pronto=true"),dataType:"json",success:function(a){e(c,a,!0)},error:function(){window.location.href=c}})}}function l(a){a=a.originalEvent.state;null!==a&&a.url!==h&&e(a.url,a.data,!1)}function e(a,b,f){g.trigger("pronto.load").scrollTop(0);"undefined"=== typeof _gaq&&(_gaq=[]);_gaq.push(["_trackPageview"],a);document.title=b.title.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#039;/g,"'");if("Object"==typeof b.content)for(var e in b.content)d("#"+e).html(b.content[e]);else c.$container.html(b.content);f&&history.pushState({url:a,data:b},"state-"+a,a);h=a;g.trigger("pronto.render")}var f=window.history&&window.history.pushState&&window.history.replaceState,g=d(window),h="",c= {container:"#pronto",selector:"a"},j={supported:function(){return f}};d.pronto=function(a){return j[a]?j[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?k.apply(this,arguments):this}})(jQuery);