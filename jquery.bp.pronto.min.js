/*
 * Pronto Plugin
 * @author Ben Plum
 * @version 0.3.1
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function i(a){d.extend(b,a||{});b.$body=d("body");b.$container=d(b.container);f&&(history.replaceState({url:window.location.href,data:{title:d("head").find("title").text(),content:d(b.container).html()}},"state-"+window.location.href,window.location.href),e.on("popstate",j),b.$body.on("click.pronto",b.selector,k))}function k(a){var c=a.currentTarget;if(!(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)&&!(location.protocol!==c.protocol||location.host!==c.host)&&!(c.hash&&c.href.replace(c.hash, "")===location.href.replace(location.hash,"")||c.href===location.href+"#")){a.preventDefault();a.stopPropagation();var b=c.href;e.trigger("pronto.request");d.ajax({url:b+(b.indexOf("?")?"?pronto=true":"&pronto=true"),dataType:"json",success:function(a){g(b,a,!0)},error:function(){window.location.href=b}})}}function j(a){a=a.originalEvent.state;null!==a&&g(a.url,a.data,!1)}function g(a,c,d){e.scrollTop(0);"undefined"===typeof _gaq&&(_gaq=[]);_gaq.push(["_trackPageview"],a);document.title=c.title.replace(/&nbsp;/g, " ");e.trigger("pronto.load");b.$container.html(c.content);e.trigger("pronto.render");d&&history.pushState({url:a,data:c},"state-"+a,a)}var f=window.history&&window.history.pushState&&window.history.replaceState,e=d(window),b={container:"#pronto",selector:"a"},h={supported:function(){return f}};d.pronto=function(a){return h[a]?h[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?i.apply(this,arguments):this}})(jQuery);