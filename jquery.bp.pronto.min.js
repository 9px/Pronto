/*
 * Pronto Plugin
 * @author Ben Plum
 * @version 0.6.1
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(e){function n(a){e.extend(c,a||{});c.$body=e("body");c.$container=e(c.container);h&&(d=window.location.href,j(),f.on("popstate",p),c.$body.on("click.pronto",c.selector,q))}function q(a){var b=a.currentTarget;if(!(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)&&!(window.location.protocol!==b.protocol||window.location.host!==b.host))if(d==b.href||b.hash&&b.href.replace(b.hash,"")===window.location.href.replace(location.hash,"")||b.href===window.location.href+"#")j();else{a.preventDefault(); a.stopPropagation();var g=b.href;f.trigger("pronto.request");e.ajax({url:g+(-1<g.indexOf("?")?"&"+c.requestKey+"=true":"?"+c.requestKey+"=true"),dataType:"json",success:function(a){"String"==typeof a&&(a=e.parseJSON(a));l(g,a,0,!0);r++},error:function(){window.location.href=g}})}}function p(a){a=a.originalEvent.state;null!==a&&a.url!==d&&l(a.url,a.data,a.scroll,!1)}function l(a,b,g,h){f.trigger("pronto.load");"undefined"===typeof _gaq&&(_gaq=[]);_gaq.push(["_trackPageview"],a);j();for(var k in c.target)b.hasOwnProperty(k)&& e(c.target[k]).html(b[k]);d=a;h?history.pushState({url:d,data:b,scroll:0},"state-"+d,d):j();f.trigger("pronto.render");f.scrollTop(g)}function j(){var a=[],b;for(b in c.target)a[b]=e(c.target[b]).html();history.replaceState({url:d,data:a,scroll:f.scrollTop()},"state-"+d,d)}var f=e(window),h=window.history&&window.history.pushState&&window.history.replaceState,d="",r=0,c={selector:"a",requestKey:"pronto",target:{title:"title",content:"#pronto"}},m={supported:function(){return h}};e.pronto=function(a){return m[a]? m[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?n.apply(this,arguments):this}})(jQuery);