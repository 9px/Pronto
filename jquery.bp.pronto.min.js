/*
 * Pronto Plugin
 * @author Ben Plum
 * @version 0.5.1
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function j(a){d.extend(b,a||{});b.$body=d("body");b.$container=d(b.container);g&&(history.replaceState({url:window.location.href,data:{title:d("head").find("title").text(),content:d(b.container).html()}},"state-"+window.location.href,window.location.href),f=window.location.href,e.on("popstate",k),b.$body.on("click.pronto",b.selector,l))}function l(a){var c=a.currentTarget;if(!(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)&&!(window.location.protocol!==c.protocol||window.location.host!== c.host)&&!(c.hash&&c.href.replace(c.hash,"")===window.location.href.replace(location.hash,"")||c.href===window.location.href+"#")){a.preventDefault();a.stopPropagation();var b=c.href;e.trigger("pronto.request");d.ajax({url:b+(-1<b.indexOf("?")?"?pronto=true":"&pronto=true"),dataType:"json",success:function(a){h(b,a,!0)},error:function(){window.location.href=b}})}}function k(a){a=a.originalEvent.state;null!==a&&a.url!==f&&h(a.url,a.data,!1)}function h(a,c,d){e.trigger("pronto.load").scrollTop(0);"undefined"=== typeof _gaq&&(_gaq=[]);_gaq.push(["_trackPageview"],a);document.title=c.title.replace(/&nbsp;/g," ");b.$container.html(c.content);d&&history.pushState({url:a,data:c},"state-"+a,a);f=a;e.trigger("pronto.render")}var g=window.history&&window.history.pushState&&window.history.replaceState,e=d(window),f="",b={container:"#pronto",selector:"a"},i={supported:function(){return g}};d.pronto=function(a){return i[a]?i[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?j.apply(this, arguments):this}})(jQuery);