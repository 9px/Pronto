/*
 * Pronto Plugin
 * @author Ben Plum
 * @version 0.8.0
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function p(a){d.extend(c,a||{});c.$body=d("body");c.$container=d(c.container);g&&(e=window.location.href,k(),f.on("popstate",q),c.$body.on("click.pronto",c.selector,r))}function r(a){var b=a.currentTarget;1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||window.location.protocol!==b.protocol||window.location.host!==b.host||(b.hash&&b.href.replace(b.hash,"")===window.location.href.replace(location.hash,"")||b.href===window.location.href+"#"?k():(a.preventDefault(),a.stopPropagation(), e==b.href?k():l(b.href)))}function l(a){f.trigger("pronto.request");d.ajax({url:a+(-1<a.indexOf("?")?"&"+c.requestKey+"=true":"?"+c.requestKey+"=true"),dataType:"json",success:function(b){"String"==typeof b&&(b=d.parseJSON(b));m(a,b,0,!0);s++},error:function(b){window.location.href=a}})}function q(a){a=a.originalEvent.state;null!==a&&a.url!==e&&(f.trigger("pronto.request"),m(a.url,a.data,a.scroll,!1))}function m(a,b,e,d){null!==h&&(clearTimeout(h),h=null);h=setTimeout(function(){t(a,b,e,d)},c.requestDelay)} function t(a,b,d,h){f.trigger("pronto.load");var g=g||[];g.push(["_trackPageview"],a);k();c.onRender.call(this,b);e=a;h?history.pushState({url:e,data:b,scroll:0},"state-"+e,e):k();f.trigger("pronto.render");f.scrollTop(d)}function k(){var a=[],b;for(b in c.target)a[b]=d(c.target[b]).html();history.replaceState({url:e,data:a,scroll:f.scrollTop()},"state-"+e,e)}var f=d(window),g=window.history&&window.history.pushState&&window.history.replaceState,e="",s=0,h=null,c={onRender:function(a){if("undefined"!= typeof a)for(var b in c.target)a.hasOwnProperty(b)&&d(c.target[b]).html(a[b])},selector:"a",requestKey:"pronto",requestDelay:0,target:{title:"title",content:"#pronto"}},n={open:function(a){g?a&&l(a):window.location.href=a},supported:function(){return g}};d.pronto=function(a){return n[a]?n[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof a&&a?this:p.apply(this,arguments)}})(jQuery);